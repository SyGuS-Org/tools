#!/bin/bash

# Requires: SynthLib2Tester and $SOLVER in path

SEMANTIC_CHECK_TIMEOUT=10
SOLVER=ajr-cvc4

# SynthLib2Tester should exist in current path.

SOLVEROUT=$1
SYGUSBENCHNAME=$2

# Run the SynthLib2Tester tool to check grammar
#echo "[debug] Run SynthLib2Tester to check grammar..."
SynthLib2Tester $SOLVEROUT $SYGUSBENCHNAME > temp-check-syntax.txt

cat temp-check-syntax.txt | grep result

if grep -q adheres=true temp-check-syntax.txt;
then
  #echo "[debug] Run SMT solvers to check semantic correctness..."
  ulimit -t $SEMANTIC_CHECK_TIMEOUT;$SOLVER --lang=smt2 __sygus_grmrchecker_output.smt >& temp-check-semantic.txt
  if grep -q unsat temp-check-semantic.txt;
  then
    echo "FAIL-SEMANTIC-UNSAT"
  elif grep -q sat temp-check-semantic.txt;
  then
    echo "SUCCESS"
  else
    echo "FAIL-SEMANTIC"
  fi
else
  echo "FAIL-SYNTAX"

fi

#echo "[debug] Finished"
