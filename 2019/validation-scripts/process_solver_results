#!/bin/bash

# Requires: clean_starexec_out, process_result, SynthLib2Tester in path

STAREXECOUTDIR=$1
BENCHDIR=$2

# $STAREXECOUTDIR is path to base directory of StarExec job output
# $BENCHDIR is path to sygus benchmarks (parallel to the job output space)

(cd $STAREXECOUTDIR

#echo "[debug] Analyzing $BENCHDIR"

for FILE in $(find -name '*.txt'); do 
  #echo "[debug] $FILE"
  
  clean_starexec_out $FILE > tmp-out.txt
  
  # extract the benchmark name
  BENCHNAME="$(dirname "$FILE")"
  #echo "[debug] benchmark: $BENCHNAME"
  
  # get the cooresponding sygus input file 
  SYGUSBENCHNAME="$BENCHDIR$BENCHNAME"
  #echo "[debug] sygus benchmark: $SYGUSBENCHNAME"
  
  # Check correctness
  #echo "[debug] Process tmp.txt + $SYGUSBENCHNAME..."
  
  # Print in csv form
  echo -n "$STAREXECOUTDIR,$SYGUSBENCHNAME,"
  process_result tmp-out.txt $SYGUSBENCHNAME
done
rm tmp-out.txt
)
